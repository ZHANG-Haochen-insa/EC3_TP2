# VHDL 数字密码锁 (Digicode) 项目

本项目是基于TP VHDL课程要求实现的一个完整的数字密码锁。它使用VHDL语言编写，可在FPGA开发板（如Nexys A7）上运行。

该密码锁不仅可以验证预设的4位密码以“开门”，还支持在验证成功后动态修改密码。

## 文件结构

- `digicode_top.vhd`: 顶层文件，负责连接所有子模块，并与FPGA的物理I/O（按钮、开关、LED）接口。
- `machine_moore.vhd`: **核心逻辑**。这是一个摩尔状态机（实体名为`machine_etats`），它实现了密码验证和密码修改的全部逻辑。
- `code_entier_memoir.vhd`: 可读写的**内存模块**（实体名为`memoire`）。它负责存储4位数的密码。上电复位时，它会自动加载一个默认密码。
- `division_horloge.vhd`: **时钟分频器**。将FPGA板上的高速时钟（例如100MHz）降低到一个较慢的频率（约3Hz），以便状态机和人眼可以稳定工作。
- `TP说明.md` & `对话.md`: 根据您的要求生成的项目说明文件。
- `TP VHDL Digicode 2025.pdf`: 原始的实验指导PDF。

## 功能说明

### 1. 正常操作（开门）

- **默认密码**: `BTND` -> `BTNR` -> `BTNU` -> `BTNL`。
- **操作流程**:
    1.  上电或按下`CPU_RESETN`按钮后，系统进入待机状态 (`ST_IDLE`)。
    2.  按照从右到左的顺序依次按下四个密码按钮 (`BTND`, `BTNR`, `BTNU`, `BTNL`)。
    3.  每按对一个数字，地址LED（`LED1`, `LED0`）会相应地递增（00 -> 01 -> 10 -> 11）。
    4.  如果中途按错，系统将进入错误状态 (`ST_FAIL`)，需要松开所有按钮才能返回待机状态，重新输入。
    5.  当4位密码全部正确输入后，`LED2`（开门指示灯）会点亮，表示“门已打开”。
    6.  此时，系统进入`ST_OPEN`状态。要重新输入密码，需要先将`SW0`（门开关）拨回低电平（模拟“关门”），系统才会回到待机状态。

### 2. 修改密码

- **触发条件**: 必须先成功输入当前密码，使系统进入`ST_OPEN`状态（即`LED2`点亮）。
- **操作流程**:
    1.  在`LED2`点亮的状态下，将`SW1`（修改模式开关）拨到高电平。
    2.  `LED3`（修改模式指示灯）会点亮，表示系统已进入密码修改模式。
    3.  此时，按照您希望的顺序输入4个新的密码按键。您按下的每一个键都将被依次写入内存。
    4.  地址LED（`LED1`, `LED0`）同样会显示当前正在写入第几位密码。
    5.  输入完4位新密码后，系统自动返回待机状态（`ST_IDLE`），`LED3`熄灭。
    6.  现在，新的密码已经生效。您可以将`SW1`拨回低电平。

## 硬件端口映射

| 物理端口   | 信号/功能             | 描述                                       |
|------------|-----------------------|--------------------------------------------|
| `CPU_RESETN`| **全局复位**            | 按下以重置整个系统和密码。                 |
| `CLK100MHZ`| **系统时钟**            | FPGA板载100MHz时钟输入。                   |
| `BTND`     | 密码输入 `0001`       | 密码的第1位（也是最右边的按钮）。          |
| `BTNR`     | 密码输入 `0010`       | 密码的第2位。                              |
| `BTNU`     | 密码输入 `0100`       | 密码的第3位。                              |
| `BTNL`     | 密码输入 `1000`       | 密码的第4位（也是最左边的按钮）。          |
| `SW0`      | **门状态开关 (`porte`)** | `0`=门已关，`1`=门已开。开门后需将其置0才能再次操作。 |
| `SW1`      | **修改模式开关 (`modif_code`)** | 在门打开时置1，进入密码修改模式。          |
| `LED0`     | 地址位 0 (`adresse(0)`) | 指示当前操作的密码地址。                   |
| `LED1`     | 地址位 1 (`adresse(1)`) | 指示当前操作的密码地址。                   |
| `LED2`     | **开门指示灯 (`ouverture_porte`)** | `1`=密码正确，门已打开。                   |
| `LED3`     | **修改模式指示灯 (`led_chang_code`)**| `1`=系统处于密码修改模式。                 |

---
*该文档由AI生成，旨在帮助理解和使用VHDL项目。*
