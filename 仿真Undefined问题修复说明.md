# ä»¿çœŸUndefinedé—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ› é—®é¢˜æè¿°

åœ¨è¿è¡Œç¬¬ä¸€é—®çš„testbench (`moore_q1_tb.vhd`) æ—¶ï¼Œç»å¤§éƒ¨åˆ†ä¿¡å·æ˜¾ç¤ºä¸º **undefined** æˆ– **'U'**ã€‚

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### é—®é¢˜1: çŠ¶æ€ä¿¡å·æœªåˆå§‹åŒ–

**æ–‡ä»¶**: `moore_q1.vhd` (ä»¥åŠ `machine_moore.vhd`)

**é—®é¢˜ä»£ç **:
```vhdl
signal state, next_state : state_type;  -- æ²¡æœ‰åˆå§‹å€¼ï¼
```

**é—®é¢˜è§£é‡Š**:
- åœ¨VHDLä»¿çœŸä¸­ï¼Œæœªåˆå§‹åŒ–çš„ä¿¡å·é»˜è®¤å€¼ä¸º `'U'` (Uninitialized)
- å½“ `state` ä¿¡å·ä¸º `'U'` æ—¶ï¼š
  1. `OUTPUT_DECODE` process æ— æ³•æ­£ç¡®åŒ¹é… case è¯­å¥
  2. `adresse_machine` è¾“å‡ºä¿æŒä¸º `'U'`
  3. memoire æ¨¡å—æ— æ³•è¯»å–æœªå®šä¹‰çš„åœ°å€
  4. æ•´ä¸ªç³»ç»Ÿé™·å…¥æœªå®šä¹‰çŠ¶æ€

**ä¿®å¤æ–¹æ¡ˆ**:
```vhdl
signal state, next_state : state_type := ST_IDLE_1;  -- âœ… æ·»åŠ åˆå§‹å€¼
```

---

### é—®é¢˜2: å†…å­˜æ•°ç»„æœªåˆå§‹åŒ–

**æ–‡ä»¶**: `memoire.vhd`

**é—®é¢˜ä»£ç **:
```vhdl
signal code : tcode;  -- æ²¡æœ‰åˆå§‹å€¼ï¼
```

**é—®é¢˜è§£é‡Š**:
- å†…å­˜æ•°ç»„ `code` åœ¨ä»¿çœŸå¼€å§‹æ—¶åŒ…å«æœªå®šä¹‰å€¼
- å³ä½¿åœ¨ reset è¿‡ç¨‹ä¸­ä¼šè¢«åˆå§‹åŒ–ï¼Œä½†åœ¨ reset ä¹‹å‰ï¼š
  1. å¦‚æœ `adresse` ä¸ºæœªå®šä¹‰ï¼Œ`sortie_memoire <= code(to_integer(unsigned(adresse)))` ä¼šå¤±è´¥
  2. `to_integer(unsigned("UU"))` æ— æ³•è½¬æ¢ï¼Œå¯¼è‡´è¯»å–å¤±è´¥
  3. `sortie_memoire` å˜ä¸ºæœªå®šä¹‰

**ä¿®å¤æ–¹æ¡ˆ**:
```vhdl
signal code : tcode := ("0001", "0010", "0100", "1000");  -- âœ… æ·»åŠ åˆå§‹å€¼
```

---

### é—®é¢˜3: Resetä¿¡å·åˆå§‹çŠ¶æ€

**æ–‡ä»¶**: `moore_q1_tb.vhd`, `machine_etats_tb.vhd`

**é—®é¢˜ä»£ç **:
```vhdl
signal reset : STD_LOGIC := '0';  -- Resetä»ä½ç”µå¹³å¼€å§‹
```

**é—®é¢˜è§£é‡Š**:
- ä»¿çœŸå¼€å§‹æ—¶ï¼Œreset ä¸º '0'ï¼ˆä¸æ´»åŠ¨ï¼‰
- åœ¨ç¬¬ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸåˆ°æ¥å‰ï¼ŒçŠ¶æ€æœºå¯èƒ½å¤„äºæœªå®šä¹‰çŠ¶æ€
- è™½ç„¶ç¨åä¼šæ¿€æ´» resetï¼Œä½†åœ¨æ­¤ä¹‹å‰ç³»ç»Ÿå·²ç»å¤„äºæ··ä¹±çŠ¶æ€

**ä¿®å¤æ–¹æ¡ˆ**:
```vhdl
signal reset : STD_LOGIC := '1';  -- âœ… Resetä»é«˜ç”µå¹³å¼€å§‹
```

---

## ğŸ”§ ä¿®å¤æ±‡æ€»

### ä¿®å¤çš„æ–‡ä»¶æ¸…å•

#### Q1æ–‡ä»¶å¤¹
1. âœ… `Q1_Validation_Basique/moore_q1.vhd`
   - ç¬¬35è¡Œï¼š`signal state, next_state : state_type := ST_IDLE_1;`

2. âœ… `Q1_Validation_Basique/memoire.vhd`
   - ç¬¬22è¡Œï¼š`signal code : tcode := ("0001", "0010", "0100", "1000");`

3. âœ… `Q1_Validation_Basique/moore_q1_tb.vhd`
   - ç¬¬38è¡Œï¼š`signal reset : STD_LOGIC := '1';`

#### Q2æ–‡ä»¶å¤¹
1. âœ… `Q2_Modification_Code/machine_moore.vhd`
   - ç¬¬43è¡Œï¼š`signal state, next_state : state_type := ST_IDLE;`

2. âœ… `Q2_Modification_Code/memoire.vhd`
   - ç¬¬22è¡Œï¼š`signal code : tcode := ("0001", "0010", "0100", "1000");`

3. âœ… `Q2_Modification_Code/machine_etats_tb.vhd`
   - ç¬¬42è¡Œï¼š`signal reset : STD_LOGIC := '1';`

#### æ ¹ç›®å½•ï¼ˆåŸå§‹æ–‡ä»¶ï¼‰
1. âœ… `moore_q1.vhd`
2. âœ… `machine_moore.vhd`
3. âœ… `memoire.vhd`
4. âœ… `moore_q1_tb.vhd`

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### ä»¿çœŸå¼€å§‹æ—¶çš„ä¿¡å·çŠ¶æ€

| ä¿¡å· | ä¿®å¤å‰ | ä¿®å¤å |
|-----|--------|--------|
| `state` | 'U' (æœªå®šä¹‰) | ST_IDLE_1 (æ˜ç¡®çŠ¶æ€) |
| `next_state` | 'U' (æœªå®šä¹‰) | ST_IDLE_1 (æ˜ç¡®çŠ¶æ€) |
| `code(0..3)` | "UUUU" (æœªå®šä¹‰) | "0001", "0010", "0100", "1000" |
| `adresse_machine` | "UU" (æœªå®šä¹‰) | "00" (ç”±OUTPUT_DECODEé©±åŠ¨) |
| `contenu_mem` | "UUUU" (æœªå®šä¹‰) | "0001" (ä»code(0)è¯»å–) |
| `reset` | '0' (ä¸æ´»åŠ¨) | '1' (æ´»åŠ¨ï¼Œå‡†å¤‡å¤ä½) |

---

## ğŸ§ª éªŒè¯ä¿®å¤

### é‡æ–°è¿è¡Œä»¿çœŸ

```bash
# åœ¨Q1_Validation_Basiqueæ–‡ä»¶å¤¹ä¸­
cd Q1_Validation_Basique/

# ä½¿ç”¨GHDLé‡æ–°ç¼–è¯‘
ghdl -a memoire.vhd
ghdl -a moore_q1.vhd
ghdl -a moore_q1_tb.vhd

# ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
ghdl -e moore_q1_tb

# è¿è¡Œä»¿çœŸ
ghdl -r moore_q1_tb --wave=moore_q1_fixed.ghw

# æŸ¥çœ‹æ³¢å½¢
gtkwave moore_q1_fixed.ghw
```

### é¢„æœŸç»“æœ

ç°åœ¨åœ¨ä»¿çœŸæ³¢å½¢ä¸­åº”è¯¥èƒ½çœ‹åˆ°ï¼š

1. âœ… **æ—¶é—´0**: æ‰€æœ‰ä¿¡å·éƒ½æœ‰æ˜ç¡®çš„å€¼ï¼ˆä¸å†æ˜¯'U'ï¼‰
   - `state` = ST_IDLE_1
   - `adresse_machine` = "00"
   - `contenu_mem` = "0001"
   - `reset` = '1'

2. âœ… **ç¬¬ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå**:
   - resetè¢«å¤„ç†
   - çŠ¶æ€æœºä¿æŒåœ¨ST_IDLE_1
   - æ‰€æœ‰è¾“å‡ºæ­£å¸¸

3. âœ… **2ä¸ªæ—¶é’Ÿå‘¨æœŸå** (reseté‡Šæ”¾):
   - ç³»ç»Ÿå‡†å¤‡æ¥å—è¾“å…¥
   - æ‰€æœ‰ä¿¡å·éƒ½å®šä¹‰æ˜ç¡®

4. âœ… **æ•´ä¸ªæµ‹è¯•è¿‡ç¨‹**:
   - ä¸å†æœ‰undefinedä¿¡å·
   - æ‰€æœ‰æµ‹è¯•åº”è¯¥é€šè¿‡

---

## ğŸ’¡ VHDLä¿¡å·åˆå§‹åŒ–æœ€ä½³å®è·µ

### 1. çŠ¶æ€æœºä¿¡å·åˆå§‹åŒ–

**æ¨èåšæ³•**:
```vhdl
type state_type is (ST_IDLE, ST_ACTIVE, ST_DONE);
signal state : state_type := ST_IDLE;  -- âœ… å§‹ç»ˆç»™çŠ¶æ€ä¿¡å·åˆå§‹å€¼
```

**åŸå› **:
- ç¡®ä¿ä»¿çœŸä»å·²çŸ¥çŠ¶æ€å¼€å§‹
- é¿å…ç»„åˆé€»è¾‘processä¸­çš„æœªå®šä¹‰è¡Œä¸º
- æé«˜ä»¿çœŸå¯é¢„æµ‹æ€§

### 2. æ•°ç»„å’Œå¤æ‚ç±»å‹åˆå§‹åŒ–

**æ¨èåšæ³•**:
```vhdl
type mem_array is array (0 to 3) of std_logic_vector(3 downto 0);
signal mem : mem_array := (others => "0000");  -- âœ… ä½¿ç”¨èšåˆèµ‹å€¼
-- æˆ–è€…æ˜ç¡®æŒ‡å®šæ¯ä¸ªå…ƒç´ 
signal mem : mem_array := ("0001", "0010", "0100", "1000");  -- âœ…
```

### 3. Testbenchä¸­çš„æ§åˆ¶ä¿¡å·

**æ¨èåšæ³•**:
```vhdl
signal clk   : std_logic := '0';  -- âœ… æ—¶é’Ÿä»0å¼€å§‹
signal reset : std_logic := '1';  -- âœ… Resetä»æ´»åŠ¨çŠ¶æ€å¼€å§‹
signal enable: std_logic := '0';  -- âœ… æ§åˆ¶ä¿¡å·ä»éæ´»åŠ¨å¼€å§‹
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä»¿çœŸ vs ç»¼åˆ

**é‡è¦**: ä¿¡å·åˆå§‹å€¼ä¸»è¦ç”¨äº**ä»¿çœŸ**ï¼Œåœ¨å®é™…ç¡¬ä»¶ä¸­ï¼š

1. **FPGAç»¼åˆå**:
   - ä¿¡å·åˆå§‹å€¼å¯èƒ½è¢«å¿½ç•¥ï¼ˆå–å†³äºç»¼åˆå·¥å…·ï¼‰
   - å¯„å­˜å™¨çš„åˆå§‹çŠ¶æ€ç”±é…ç½®æ¯”ç‰¹æµå†³å®š
   - **å¿…é¡»ä¾èµ–resetä¿¡å·**æ¥åˆå§‹åŒ–ç³»ç»Ÿ

2. **æœ€ä½³å®è·µ**:
   ```vhdl
   -- âœ… æ—¢æä¾›åˆå§‹å€¼ï¼ˆä»¿çœŸç”¨ï¼‰ï¼Œåˆæœ‰reseté€»è¾‘ï¼ˆç¡¬ä»¶ç”¨ï¼‰
   signal state : state_type := ST_IDLE;  -- ä»¿çœŸåˆå§‹å€¼

   process(clk)
   begin
       if rising_edge(clk) then
           if reset = '1' then
               state <= ST_IDLE;  -- ç¡¬ä»¶reset
           else
               state <= next_state;
           end if;
       end if;
   end process;
   ```

3. **ä¸ºä»€ä¹ˆä¸¤è€…éƒ½è¦**:
   - åˆå§‹å€¼ â†’ ä»¿çœŸä»å·²çŸ¥çŠ¶æ€å¼€å§‹
   - Reseté€»è¾‘ â†’ ç¡¬ä»¶èƒ½æ­£ç¡®åˆå§‹åŒ–

---

## ğŸ“ˆ é—®é¢˜è¯Šæ–­æµç¨‹å›¾

```
ä»¿çœŸæ˜¾ç¤ºUndefined
    â†“
æ£€æŸ¥æ³¢å½¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª'U'ä¿¡å·
    â†“
è¿½è¸ªè¯¥ä¿¡å·çš„é©±åŠ¨æº
    â†“
æ˜¯çŠ¶æ€æœºè¾“å‡º? â”€â”€Yesâ†’ æ£€æŸ¥stateä¿¡å·æ˜¯å¦åˆå§‹åŒ–
    â”‚                        â†“
    No                    æ·»åŠ åˆå§‹å€¼: := ST_IDLE
    â†“
æ˜¯å†…å­˜è¾“å‡º? â”€â”€Yesâ†’ æ£€æŸ¥å†…å­˜æ•°ç»„æ˜¯å¦åˆå§‹åŒ–
    â”‚                    â†“
    No                æ·»åŠ åˆå§‹å€¼: := (...)
    â†“
æ˜¯ç»„åˆé€»è¾‘è¾“å‡º? â”€â”€Yesâ†’ æ£€æŸ¥è¾“å…¥ä¿¡å·æ˜¯å¦éƒ½å·²å®šä¹‰
    â”‚                        â†“
    No                    åˆå§‹åŒ–æ‰€æœ‰è¾“å…¥
    â†“
æ£€æŸ¥æ—¶åº
é‡æ–°ç¼–è¯‘å’Œä»¿çœŸ
```

---

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

åœ¨è¿è¡Œä»¿çœŸå‰ï¼Œç¡®è®¤ï¼š

- [ ] æ‰€æœ‰çŠ¶æ€æœºçš„`state`ä¿¡å·éƒ½æœ‰åˆå§‹å€¼
- [ ] æ‰€æœ‰å†…å­˜/æ•°ç»„ç±»å‹ä¿¡å·éƒ½æœ‰åˆå§‹å€¼
- [ ] Testbenchçš„`reset`ä¿¡å·ä»'1'å¼€å§‹
- [ ] æ‰€æœ‰è¾“å…¥ä¿¡å·éƒ½æœ‰æ˜ç¡®çš„åˆå§‹å€¼
- [ ] é‡æ–°ç¼–è¯‘äº†æ‰€æœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶
- [ ] æ¸…ç†äº†ä¹‹å‰çš„ç¼–è¯‘è¾“å‡ºï¼ˆ`ghdl --clean`ï¼‰

---

## ğŸ“ å­¦ä¹ è¦ç‚¹

é€šè¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½ åº”è¯¥ç†è§£ï¼š

1. **VHDLä¿¡å·åˆå§‹åŒ–çš„é‡è¦æ€§**
   - æœªåˆå§‹åŒ– = 'U' (Uninitialized)
   - å½±å“æ•´ä¸ªç³»ç»Ÿçš„ä»¿çœŸ

2. **ä¿¡å·ä¼ æ’­**
   - ä¸€ä¸ª'U'ä¿¡å·å¯ä»¥ä¼ æ’­åˆ°æ•´ä¸ªè®¾è®¡
   - ç»„åˆé€»è¾‘ä¼šæ”¾å¤§è¿™ä¸ªé—®é¢˜

3. **ä»¿çœŸæœ€ä½³å®è·µ**
   - å§‹ç»ˆåˆå§‹åŒ–ä¿¡å·
   - ä»resetçŠ¶æ€å¼€å§‹ä»¿çœŸ
   - æ£€æŸ¥æ³¢å½¢ç¡®è®¤æ‰€æœ‰ä¿¡å·éƒ½å·²å®šä¹‰

4. **è°ƒè¯•æŠ€å·§**
   - ä»ç¬¬ä¸€ä¸ª'U'ä¿¡å·å¼€å§‹è¿½è¸ª
   - æ£€æŸ¥ä¿¡å·é©±åŠ¨é“¾
   - ä½¿ç”¨æ³¢å½¢æŸ¥çœ‹å™¨å®šä½é—®é¢˜

---

## ğŸ“š ç›¸å…³èµ„æº

- VHDLä¿¡å·åˆå§‹åŒ–è§„èŒƒ
- ModelSim/GHDLä»¿çœŸæŒ‡å—
- FPGAè®¾è®¡æœ€ä½³å®è·µ

ä¿®å¤å®Œæˆï¼ç°åœ¨testbenchåº”è¯¥èƒ½æ­£å¸¸è¿è¡Œï¼Œæ‰€æœ‰ä¿¡å·éƒ½æœ‰æ˜ç¡®çš„å€¼ã€‚ğŸ‰
